---
title: "tree"
author: "Baoyi Shi"
date: "2018年12月2日"
output: html_document
---

```{r }
library(tidyverse)
library(dplyr)
library(readr)
library(ggplot2)
library(readxl)
```


```{r }
#import and tidy tree data
tree_df = read_csv("./data/2015StreetTreesCensus_TREES.csv") %>%
  janitor::clean_names() %>%
  filter(status == "Alive")

zipcode_uhf42 = read_excel("./data/Zipcode_UHF42.xlsx") %>%
   gather(key = zipcode_no, value = zipcode, zipcode1:zipcode9) %>%
   select(-zipcode_no, uhf42_name) %>%
   filter(is.na(zipcode) == FALSE)

tree_df = left_join(tree_df, zipcode_uhf42, by = "zipcode") 

mydat = rgdal::readOGR("./UHF42/UHF_42_DOHMH.shp")

area=data.frame(uhf42_code = mydat$UHFCODE,area = mydat$SHAPE_Area) %>%
  filter(is.na(uhf42_code) == FALSE)

tree_df = left_join(tree_df, area, by = "uhf42_code")
```


```{r }
#tree density
tree_density = tree_df %>%
  group_by(uhf42_name, area, health) %>%
  dplyr::summarize(health_total = n()) %>%
  filter(is.na(uhf42_name) == FALSE) %>%
  group_by(uhf42_name) %>%
  dplyr::mutate(total = sum(health_total),
                tree_density = total/area,
                health_tree_density = health_total/area) %>%
  ungroup() %>%
  mutate(uhf42_name = forcats::fct_reorder(uhf42_name, tree_density))
```

```{r }
#proportion of each health status in UHF42
ggplot(aes(x = uhf42_name), data = tree_df) +
  geom_bar(position="fill", aes(fill = health)) +
  theme(axis.text.x = element_text(angle = 75, hjust = 1)) 
```


